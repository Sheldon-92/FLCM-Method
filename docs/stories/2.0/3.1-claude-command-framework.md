# Story 3.1: Claude Command Framework

## Status
üìù Not Started

## Story
**As a** user  
**I want** to use Claude commands to interact with FLCM  
**So that** I have a seamless development experience

## Acceptance Criteria
1. /flcm command structure defined and registered
2. Command registry and parser implemented
3. Error handling with helpful messages
4. Command history and context preservation
5. Auto-completion and help system

## Tasks / Subtasks
- [ ] Task 1: Command structure definition (AC: 1)
  - [ ] Subtask 1.1: Create command schema
  - [ ] Subtask 1.2: Define command hierarchy
  - [ ] Subtask 1.3: Register with Claude
  - [ ] Subtask 1.4: Document command syntax

- [ ] Task 2: Command parser (AC: 2)
  - [ ] Subtask 2.1: Implement argument parser
  - [ ] Subtask 2.2: Create option processor
  - [ ] Subtask 2.3: Build validation logic
  - [ ] Subtask 2.4: Add command router

- [ ] Task 3: Error handling (AC: 3)
  - [ ] Subtask 3.1: Define error types
  - [ ] Subtask 3.2: Create error messages
  - [ ] Subtask 3.3: Implement suggestions
  - [ ] Subtask 3.4: Add recovery hints

- [ ] Task 4: Context management (AC: 4)
  - [ ] Subtask 4.1: Command history storage
  - [ ] Subtask 4.2: Context preservation
  - [ ] Subtask 4.3: Session management
  - [ ] Subtask 4.4: State recovery

- [ ] Task 5: Help system (AC: 5)
  - [ ] Subtask 5.1: Auto-completion logic
  - [ ] Subtask 5.2: Help text generator
  - [ ] Subtask 5.3: Example provider
  - [ ] Subtask 5.4: Interactive guide

## Dev Notes

### Command Structure
```typescript
interface FLCMCommand {
  name: string;
  description: string;
  usage: string;
  options: CommandOption[];
  arguments: CommandArgument[];
  subcommands?: FLCMCommand[];
  handler: CommandHandler;
}

// Main command hierarchy
/flcm
  ‚îú‚îÄ‚îÄ scholar    // Analysis commands
  ‚îú‚îÄ‚îÄ create     // Content creation
  ‚îú‚îÄ‚îÄ publish    // Publishing commands
  ‚îú‚îÄ‚îÄ flow       // Full workflow
  ‚îú‚îÄ‚îÄ status     // Check status
  ‚îú‚îÄ‚îÄ config     // Configuration
  ‚îî‚îÄ‚îÄ help       // Help system
```

### Command Examples
```bash
# Scholar analysis
/flcm scholar --input "file.pdf" --framework "SWOT-USED"
/flcm scholar --batch "folder/" --all-frameworks

# Content creation
/flcm create --mode quick --topic "AI trends"
/flcm create --mode custom --dialogue
/flcm create --voice-sample "previous-posts/"

# Publishing
/flcm publish --platform "xiaohongshu,zhihu"
/flcm publish --all --schedule "2024-09-15 10:00"

# Workflow
/flcm flow --input "research.pdf" --output-all
/flcm flow --watch "folder/" --auto-publish

# Status and config
/flcm status
/flcm config set scholar.timeout 10000
/flcm config get publisher.platforms
```

### Command Parser
```typescript
interface CommandParser {
  parse(input: string): ParsedCommand;
  validate(command: ParsedCommand): ValidationResult;
  resolve(command: ParsedCommand): ResolvedCommand;
  execute(command: ResolvedCommand): Promise<CommandResult>;
}

interface ParsedCommand {
  command: string;
  subcommand?: string;
  arguments: Record<string, any>;
  options: Record<string, any>;
  raw: string;
}
```

### Error Handling
```typescript
class CommandError extends Error {
  constructor(
    message: string,
    public code: string,
    public suggestions?: string[],
    public examples?: string[]
  ) {
    super(message);
  }
}

// Error examples
new CommandError(
  "Unknown framework 'SWAT'",
  "INVALID_FRAMEWORK",
  ["Did you mean 'SWOT-USED'?"],
  ["/flcm scholar --framework SWOT-USED"]
);
```

## Testing Requirements
- Command parsing accuracy
- Error message clarity
- Context preservation
- Auto-completion functionality
- Help text completeness

## Definition of Done
- [ ] All commands registered
- [ ] Parser handling all cases
- [ ] Errors are helpful
- [ ] Context preserved
- [ ] Help system complete
- [ ] Tests passing with >80% coverage

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-09-01 | 1.0 | Initial story creation | System |

## Dev Agent Record
*To be populated during development*

### File List
**To Create:**
- `.claude/commands/FLCM/command-definitions.yaml`
- `.flcm-core/claude/command-parser.ts`
- `.flcm-core/claude/command-registry.ts`
- `.flcm-core/claude/command-handlers/*.ts`
- `.flcm-core/claude/help-system.ts`