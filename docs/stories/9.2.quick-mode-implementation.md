# Story 9.2: Quick Mode Implementation

## Status
Approved

## Story
**As a** user,  
**I want** a fast content creation option,  
**so that** I can produce content quickly when needed.

**Estimated Time:** 4-5 hours

## Acceptance Criteria
1. 20-30 minute workflow achieved
2. Automatic methodology selection
3. Streamlined agent interactions
4. Quality thresholds maintained
5. User interruption supported
6. Mode switching seamless

## Tasks / Subtasks
- [ ] Implement Quick Mode workflow (AC: 1)
  - [ ] Create QuickModeOrchestrator class
  - [ ] Define 20-30 minute time budget
  - [ ] Implement time allocation per agent
  - [ ] Add progress tracking
  - [ ] Create timeout handling
  - [ ] Build completion predictor
- [ ] Build automatic methodology selection (AC: 2)
  - [ ] Create MethodologySelector class
  - [ ] Define quick mode methodology subset
  - [ ] Implement selection heuristics
  - [ ] Add performance-based selection
  - [ ] Create fallback methodologies
  - [ ] Track methodology effectiveness
- [ ] Streamline agent interactions (AC: 3)
  - [ ] Define minimal agent pipeline
  - [ ] Skip optional agents (Scholar initially)
  - [ ] Reduce iteration rounds (1-2 max)
  - [ ] Implement fast-path communication
  - [ ] Remove blocking operations
  - [ ] Use cached results where possible
- [ ] Maintain quality thresholds (AC: 4)
  - [ ] Define minimum quality metrics
  - [ ] Implement quality gates
  - [ ] Add quality vs speed tradeoffs
  - [ ] Create quality alerts
  - [ ] Track quality degradation
  - [ ] Implement quality recovery
- [ ] Support user interruption (AC: 5)
  - [ ] Add interrupt handling
  - [ ] Save partial progress
  - [ ] Implement graceful stopping
  - [ ] Create resume capability
  - [ ] Handle timeout gracefully
  - [ ] Provide partial results
- [ ] Enable mode switching (AC: 6)
  - [ ] Create mode transition logic
  - [ ] Transfer state between modes
  - [ ] Preserve work done
  - [ ] Handle methodology changes
  - [ ] Update time allocations
  - [ ] Notify agents of mode change

## Dev Notes

### Quick Mode Architecture (from docs/architecture/core-workflows.md):
Quick Mode implements simplified Collector → Creator pipeline, skipping Scholar initially for speed.

### Quick Mode Workflow:
```typescript
class QuickModeOrchestrator {
  private readonly TIME_BUDGET = 30; // minutes
  private readonly TIME_ALLOCATION = {
    collector: 5,     // 5 minutes
    creator: 15,      // 15 minutes
    adapter: 8,       // 8 minutes
    buffer: 2         // 2 minutes buffer
  };
  
  async execute(input: string): Promise<PublishPackage> {
    const startTime = Date.now();
    
    // Phase 1: Collection (5 min)
    const brief = await this.timedExecution(
      () => this.collector.quickCollect(input),
      this.TIME_ALLOCATION.collector
    );
    
    // Phase 2: Creation (15 min)
    const draft = await this.timedExecution(
      () => this.creator.quickCreate(brief),
      this.TIME_ALLOCATION.creator
    );
    
    // Phase 3: Adaptation (8 min)
    const adaptations = await this.timedExecution(
      () => this.adapter.quickAdapt(draft),
      this.TIME_ALLOCATION.adapter
    );
    
    return this.packageResults(brief, draft, adaptations);
  }
  
  private async timedExecution<T>(
    task: () => Promise<T>,
    timeLimit: number
  ): Promise<T> {
    return Promise.race([
      task(),
      this.timeout(timeLimit * 60 * 1000)
    ]);
  }
}
```

### Methodology Selection:
```typescript
interface QuickModeMethodologies {
  collector: ['RICE'];  // Only essential signal extraction
  creator: ['SPARK'];   // Fast ideation framework
  adapter: ['hooks'];   // Focus on hooks only
}

class MethodologySelector {
  selectForQuickMode(agent: AgentId): string[] {
    // Return minimal effective methodologies
    const quickMethodologies: Record<AgentId, string[]> = {
      collector: ['RICE'],           // Fast signal extraction
      scholar: [],                   // Skip in quick mode
      creator: ['SPARK', 'voice'],   // Quick creation + voice
      adapter: ['hooks', 'hashtags'] // Essential adaptations
    };
    
    return quickMethodologies[agent];
  }
  
  selectBasedOnContent(content: string): string[] {
    // Heuristic selection based on content type
    if (content.length < 500) {
      return ['minimal'];
    } else if (this.isT

echnical(content)) {
      return ['technical-quick'];
    } else {
      return ['standard-quick'];
    }
  }
}
```

### Streamlined Pipeline:
```typescript
interface QuickModePipeline {
  agents: ['collector', 'creator', 'adapter'];
  skipAgents: ['scholar'];  // Skip for speed
  iterations: {
    collector: 1,  // Single pass
    creator: 1,    // One refinement max
    adapter: 1     // No optimization loops
  };
}
```

### Quality Management:
```typescript
interface QuickModeQuality {
  minimumThresholds: {
    readability: 60,      // Flesch-Kincaid
    voiceConsistency: 70, // Voice match %
    completeness: 80      // Content coverage %
  };
  
  tradeoffs: {
    depth: 'shallow',     // Less depth for speed
    refinement: 'minimal', // Fewer iterations
    research: 'basic'     // Limited research
  };
}

class QualityGatekeeper {
  async checkQuality(content: ContentDraft): Promise<QualityCheck> {
    const metrics = await this.calculateMetrics(content);
    
    return {
      passed: this.meetsMinimum(metrics),
      metrics,
      recommendations: this.getImprovements(metrics)
    };
  }
  
  private meetsMinimum(metrics: QualityMetrics): boolean {
    return metrics.readability >= 60 &&
           metrics.voiceConsistency >= 70 &&
           metrics.completeness >= 80;
  }
}
```

### Interruption Handling:
```typescript
class InterruptHandler {
  private checkpoints: Map<string, any> = new Map();
  
  async handleInterrupt(signal: InterruptSignal): Promise<PartialResult> {
    // Save current state
    await this.saveCheckpoint();
    
    // Stop agents gracefully
    await this.stopAgents();
    
    // Return what we have
    return this.compilePartialResults();
  }
  
  async resume(checkpointId: string): Promise<void> {
    const checkpoint = await this.loadCheckpoint(checkpointId);
    
    // Restore state
    await this.restoreState(checkpoint);
    
    // Continue from saved point
    await this.continueWorkflow();
  }
}
```

### Mode Switching:
```typescript
class ModeSwitcher {
  async switchMode(
    from: 'quick' | 'standard',
    to: 'quick' | 'standard',
    currentState: WorkflowState
  ): Promise<void> {
    // Save current progress
    const checkpoint = await this.createCheckpoint(currentState);
    
    // Reconfigure agents
    if (to === 'standard') {
      // Enable Scholar agent
      await this.enableAgent('scholar');
      // Increase iterations
      this.updateIterations({ creator: 3, adapter: 2 });
      // Expand methodologies
      this.expandMethodologies();
    } else {
      // Streamline for quick mode
      await this.disableAgent('scholar');
      this.updateIterations({ creator: 1, adapter: 1 });
      this.reduceMethodologies();
    }
    
    // Resume with new configuration
    await this.resume(checkpoint);
  }
}
```

### Time Management:
```typescript
class TimeManager {
  private startTime: number;
  private timeAllocations: Map<AgentId, number>;
  
  startTimer(): void {
    this.startTime = Date.now();
  }
  
  getRemainingTime(): number {
    const elapsed = (Date.now() - this.startTime) / 1000 / 60;
    return Math.max(0, 30 - elapsed);
  }
  
  allocateTime(agent: AgentId): number {
    const remaining = this.getRemainingTime();
    const allocation = this.timeAllocations.get(agent);
    
    // Adjust if running behind
    if (remaining < allocation) {
      return remaining * 0.8; // Use 80% of remaining
    }
    
    return allocation;
  }
}
```

### Testing
**Testing Framework:** Jest
**Test File Location:** `.flcm-core/tests/workflows/`

**Unit Tests:**
- Time allocation logic
- Methodology selection
- Quality threshold checks
- Interrupt handling
- Mode switching

**Integration Tests:**
- Full quick mode workflow
- Time budget compliance
- Quality maintenance
- Interrupt and resume
- Mode transition

**Performance Tests:**
- Workflow completes < 30 min
- Quality meets thresholds
- Smooth mode switching

**Test Scenarios:**
- Simple URL → content in 25 min
- Complex source → quality maintained
- User interrupt → graceful stop
- Quick → Standard mode switch

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2024-12-28 | 1.0 | Initial story creation | Bob (SM) |

## Dev Agent Record

### Agent Model Used
_To be filled by dev agent_

### Debug Log References
_To be filled by dev agent_

### Completion Notes List
_To be filled by dev agent_

### File List
_To be filled by dev agent_

## QA Results
_To be filled by QA agent_