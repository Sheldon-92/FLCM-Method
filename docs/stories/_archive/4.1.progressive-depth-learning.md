# Story 4.1: Progressive Depth Learning Engine

## Status
Approved

## Story
**As a** user,  
**I want** to explore concepts at different depth levels,  
**so that** I can build understanding gradually.

**Estimated Time:** 5-6 hours

## Acceptance Criteria
1. 5-level depth system implemented (ELI5 to Expert)
2. Automatic complexity assessment
3. User depth preference tracking
4. Smooth transitions between levels
5. Prerequisite concept identification
6. Depth recommendation based on prior knowledge

## Tasks / Subtasks
- [ ] Implement 5-level depth system (AC: 1)
  - [ ] Create DepthLevel enum (ELI5, Beginner, Intermediate, Advanced, Expert)
  - [ ] Define content characteristics per level
  - [ ] Build level-appropriate explanation generator
  - [ ] Create vocabulary complexity filters
  - [ ] Implement example selection per level
  - [ ] Add visual/metaphor density control
- [ ] Build complexity assessment system (AC: 2)
  - [ ] Create ComplexityAnalyzer class
  - [ ] Implement readability scoring (Flesch-Kincaid)
  - [ ] Analyze concept density
  - [ ] Measure prerequisite requirements
  - [ ] Calculate technical jargon ratio
  - [ ] Assess cognitive load estimate
- [ ] Implement preference tracking (AC: 3)
  - [ ] Create UserLearningProfile interface
  - [ ] Track preferred depth levels by topic
  - [ ] Record successful learning patterns
  - [ ] Monitor comprehension speeds
  - [ ] Store feedback on explanations
  - [ ] Build preference prediction model
- [ ] Create smooth level transitions (AC: 4)
  - [ ] Implement TransitionGenerator class
  - [ ] Build bridging explanations
  - [ ] Create recap summaries
  - [ ] Generate preview of next level
  - [ ] Add difficulty ramp-up warnings
  - [ ] Implement fallback to simpler level
- [ ] Build prerequisite identification (AC: 5)
  - [ ] Create ConceptDependencyGraph
  - [ ] Identify required prior knowledge
  - [ ] Check user's knowledge base
  - [ ] Generate prerequisite learning paths
  - [ ] Flag missing foundations
  - [ ] Suggest remedial content
- [ ] Implement depth recommendation (AC: 6)
  - [ ] Create DepthRecommender class
  - [ ] Analyze user's current knowledge
  - [ ] Consider learning goals
  - [ ] Factor in time constraints
  - [ ] Account for domain expertise
  - [ ] Generate personalized recommendations

## Dev Notes

### Progressive Depth Architecture:
```typescript
enum DepthLevel {
  ELI5 = 1,        // Explain Like I'm 5
  BEGINNER = 2,    // New to the concept
  INTERMEDIATE = 3, // Some familiarity
  ADVANCED = 4,    // Deep understanding
  EXPERT = 5       // Master level
}

interface DepthCharacteristics {
  level: DepthLevel;
  vocabulary: 'simple' | 'moderate' | 'technical' | 'specialized';
  sentenceComplexity: number; // 1-10
  exampleType: 'everyday' | 'relatable' | 'domain' | 'abstract';
  metaphorUsage: 'heavy' | 'moderate' | 'light' | 'none';
  assumedKnowledge: string[];
  explanationLength: 'brief' | 'standard' | 'detailed' | 'comprehensive';
}

class ProgressiveDepthEngine {
  async explainAtDepth(
    concept: string,
    level: DepthLevel,
    context?: LearningContext
  ): Promise<DepthExplanation> {
    const characteristics = this.getCharacteristics(level);
    const prerequisites = await this.checkPrerequisites(concept, level);
    
    if (prerequisites.missing.length > 0) {
      return this.handleMissingPrerequisites(prerequisites);
    }
    
    return {
      level,
      explanation: await this.generateExplanation(concept, characteristics),
      examples: await this.selectExamples(concept, level),
      nextLevel: this.getNextLevel(level),
      prerequisites: prerequisites.required
    };
  }
}
```

### Complexity Assessment:
```typescript
interface ComplexityMetrics {
  readabilityScore: number;      // Flesch-Kincaid score
  conceptDensity: number;         // Concepts per 100 words
  jargonRatio: number;           // Technical terms %
  sentenceComplexity: number;    // Average clauses per sentence
  prerequisiteCount: number;     // Required prior concepts
  cognitiveLoad: 'low' | 'medium' | 'high' | 'very-high';
}

class ComplexityAnalyzer {
  analyze(content: string): ComplexityMetrics {
    return {
      readabilityScore: this.calculateReadability(content),
      conceptDensity: this.measureConceptDensity(content),
      jargonRatio: this.calculateJargonRatio(content),
      sentenceComplexity: this.analyzeSentenceStructure(content),
      prerequisiteCount: this.countPrerequisites(content),
      cognitiveLoad: this.estimateCognitiveLoad(content)
    };
  }
  
  recommendDepth(metrics: ComplexityMetrics): DepthLevel {
    // Map complexity to appropriate depth level
    if (metrics.readabilityScore > 80) return DepthLevel.ELI5;
    if (metrics.readabilityScore > 60) return DepthLevel.BEGINNER;
    if (metrics.readabilityScore > 40) return DepthLevel.INTERMEDIATE;
    if (metrics.readabilityScore > 20) return DepthLevel.ADVANCED;
    return DepthLevel.EXPERT;
  }
}
```

### User Learning Profile:
```typescript
interface UserLearningProfile {
  userId: string;
  topicPreferences: Map<string, DepthLevel>;
  learningSpeed: 'slow' | 'moderate' | 'fast';
  comprehensionHistory: ComprehensionRecord[];
  preferredExplanationStyle: 'visual' | 'verbal' | 'examples' | 'theoretical';
  knownConcepts: Set<string>;
  learningGoals: LearningGoal[];
}

interface ComprehensionRecord {
  concept: string;
  depth: DepthLevel;
  comprehensionScore: number;
  timeSpent: number;
  timestamp: Date;
}
```

### Level Transition Examples:
```typescript
// ELI5 → Beginner
"Now that you understand that [simple explanation], 
let's look at how this actually works..."

// Beginner → Intermediate
"You've grasped the basics. Let's explore the mechanisms 
behind [concept] and why it matters..."

// Intermediate → Advanced
"With your solid understanding, we can now examine 
the nuances and edge cases..."

// Advanced → Expert
"Ready to dive into the theoretical foundations 
and cutting-edge applications..."
```

### Prerequisite Graph:
```typescript
interface ConceptNode {
  id: string;
  name: string;
  depth: DepthLevel;
  prerequisites: string[];
  relatedConcepts: string[];
}

class ConceptDependencyGraph {
  private graph: Map<string, ConceptNode>;
  
  getPrerequisites(concept: string, targetDepth: DepthLevel): string[] {
    const node = this.graph.get(concept);
    if (!node) return [];
    
    // Get all prerequisites up to target depth
    return this.traversePrerequisites(node, targetDepth);
  }
  
  checkUserKnowledge(
    required: string[],
    userProfile: UserLearningProfile
  ): PrerequisiteCheck {
    const missing = required.filter(r => !userProfile.knownConcepts.has(r));
    const weak = required.filter(r => 
      this.isWeakKnowledge(r, userProfile)
    );
    
    return { missing, weak, ready: missing.length === 0 };
  }
}
```

### Testing
**Testing Framework:** Jest
**Test File Location:** `.flcm-core/tests/scholar/`

**Unit Tests:**
- Depth level explanation generation
- Complexity analysis accuracy
- Prerequisite identification
- Transition generation quality
- User preference tracking

**Test Scenarios:**
```
tests/fixtures/concepts/
├── simple-concept.json (good for ELI5)
├── technical-concept.json (requires prerequisites)
├── multi-level-concept.json (can explain at all levels)
└── abstract-concept.json (challenging for ELI5)
```

**Integration Tests:**
- Progressive learning journey
- Adaptive depth adjustment
- Prerequisite learning paths
- User profile evolution

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2024-12-28 | 1.0 | Initial story creation | Bob (SM) |

## Dev Agent Record

### Agent Model Used
_To be filled by dev agent_

### Debug Log References
_To be filled by dev agent_

### Completion Notes List
_To be filled by dev agent_

### File List
_To be filled by dev agent_

## QA Results
_To be filled by QA agent_