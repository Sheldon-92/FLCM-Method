# Story 5.1: Voice DNA Analysis System

## Status
Approved

## Story
**As a** Creator Agent,  
**I want** to analyze and preserve user's writing style,  
**so that** content maintains authenticity.

**Estimated Time:** 5-6 hours

## Acceptance Criteria
1. Linguistic pattern extraction implemented
2. Vocabulary preference tracking
3. Sentence structure analysis
4. Tone and emotion mapping
5. Cultural reference preservation
6. Voice consistency scoring algorithm

## Tasks / Subtasks
- [ ] Implement linguistic pattern extraction (AC: 1)
  - [ ] Create VoiceAnalyzer class
  - [ ] Extract common phrases and expressions
  - [ ] Identify signature transitions
  - [ ] Find recurring metaphors
  - [ ] Detect punctuation patterns
  - [ ] Analyze paragraph structures
- [ ] Build vocabulary preference tracker (AC: 2)
  - [ ] Create word frequency analyzer
  - [ ] Track preferred synonyms
  - [ ] Identify avoided words
  - [ ] Build personal vocabulary bank
  - [ ] Detect technical vs casual language ratio
  - [ ] Track domain-specific terminology
- [ ] Implement sentence structure analysis (AC: 3)
  - [ ] Measure average sentence length
  - [ ] Analyze sentence complexity
  - [ ] Track clause patterns
  - [ ] Identify rhythm and cadence
  - [ ] Detect parallel structures
  - [ ] Analyze opening patterns
- [ ] Create tone and emotion mapper (AC: 4)
  - [ ] Implement sentiment analysis
  - [ ] Detect formality level
  - [ ] Identify humor patterns
  - [ ] Track emotional range
  - [ ] Analyze authority indicators
  - [ ] Measure enthusiasm levels
- [ ] Build cultural reference tracker (AC: 5)
  - [ ] Identify cultural markers
  - [ ] Track pop culture references
  - [ ] Detect regional expressions
  - [ ] Note generational indicators
  - [ ] Preserve idioms and sayings
  - [ ] Track industry-specific references
- [ ] Develop voice consistency scorer (AC: 6)
  - [ ] Create voice fingerprint algorithm
  - [ ] Compare new content to baseline
  - [ ] Calculate similarity scores
  - [ ] Identify voice drift areas
  - [ ] Generate consistency report
  - [ ] Provide correction suggestions

## Dev Notes

### Voice DNA Architecture (from docs/architecture/components.md):
**Creator Agent Component:**
- Key Interface: `analyzeVoice(samples: string[]): VoiceProfile`
- Responsibility: Maintain authentic voice while producing content

### Voice Profile Structure:
```typescript
interface VoiceProfile {
  id: string;
  userId: string;
  linguistic: LinguisticPatterns;
  vocabulary: VocabularyPreferences;
  structure: StructuralPatterns;
  tone: ToneProfile;
  cultural: CulturalMarkers;
  consistency: ConsistencyMetrics;
  createdAt: Date;
  sampleCount: number;
}

interface LinguisticPatterns {
  commonPhrases: PhraseFrequency[];
  transitions: string[];
  metaphors: string[];
  punctuationStyle: {
    exclamationFreq: number;
    questionFreq: number;
    ellipsisUse: boolean;
    dashUse: boolean;
  };
}

interface VocabularyPreferences {
  frequentWords: WordFrequency[];
  preferredSynonyms: Map<string, string>;
  avoidedWords: string[];
  vocabularySize: number;
  complexityLevel: 'simple' | 'moderate' | 'complex';
  jargonUsage: number;
}

interface StructuralPatterns {
  avgSentenceLength: number;
  sentenceLengthVariation: number;
  paragraphLength: number;
  clauseComplexity: number;
  rhythmPattern: string;
}

interface ToneProfile {
  formality: number; // 0-1 scale
  sentiment: 'positive' | 'neutral' | 'negative';
  humor: number; // 0-1 scale
  authority: 'expert' | 'peer' | 'learner';
  enthusiasm: number; // 0-1 scale
}
```

### Voice Analysis Algorithm:
```typescript
class VoiceAnalyzer {
  analyze(samples: string[]): VoiceProfile {
    // 1. Tokenize and parse samples
    // 2. Extract linguistic patterns
    // 3. Build vocabulary profile
    // 4. Analyze structure
    // 5. Determine tone
    // 6. Identify cultural markers
    // 7. Generate fingerprint
    return voiceProfile;
  }
  
  compareVoice(content: string, profile: VoiceProfile): ConsistencyScore {
    // 1. Analyze new content
    // 2. Compare to baseline profile
    // 3. Calculate deviation metrics
    // 4. Identify specific differences
    return score;
  }
}
```

### Voice Consistency Scoring:
```typescript
interface ConsistencyScore {
  overall: number; // 0-100
  linguistic: number;
  vocabulary: number;
  structure: number;
  tone: number;
  deviations: Deviation[];
}

interface Deviation {
  type: string;
  location: string;
  expected: string;
  actual: string;
  suggestion: string;
}
```

### Sample Analysis Requirements:
- Minimum 3 sample texts for baseline
- At least 500 words per sample
- Samples should be from similar contexts
- More samples = better accuracy

### Libraries to Consider:
- **NLP**: natural, compromise, or nlp.js
- **Sentiment**: sentiment or text-sentiment
- **Tokenization**: wink-tokenizer
- **Statistics**: simple-statistics for patterns

### Testing
**Testing Framework:** Jest
**Test File Location:** `.flcm-core/tests/creator/`

**Unit Tests:**
- Voice extraction from sample texts
- Vocabulary analysis accuracy
- Sentence structure metrics
- Tone detection accuracy
- Consistency scoring algorithm

**Test Samples:**
Create diverse voice samples:
```
tests/fixtures/voices/
├── formal-academic.txt
├── casual-blogger.txt
├── technical-writer.txt
└── creative-storyteller.txt
```

**Integration Tests:**
- Analyze multiple real samples
- Compare voice consistency
- Test drift detection
- Verify correction suggestions

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2024-12-28 | 1.0 | Initial story creation | Bob (SM) |

## Dev Agent Record

### Agent Model Used
_To be filled by dev agent_

### Debug Log References
_To be filled by dev agent_

### Completion Notes List
_To be filled by dev agent_

### File List
_To be filled by dev agent_

## QA Results
_To be filled by QA agent_